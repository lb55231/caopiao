import{_ as J,u as K,A as Q,q as X,p as S,r as _,o as Y,a as Z,b as p,c as d,d as u,e as g,f as e,t as c,g as i,F as h,h as k,w as P,s as F,j as $,n as U}from"./index-755e54f6.js";import{f as tt,d as et,e as ot,h as nt}from"./lottery-115786bf.js";import{s as st}from"./function-call-fb17f912.js";const at={name:"Game",setup(){const I=K(),t=Q(),w=X(),n=S(()=>t.params.type),C=_({}),N=_({}),x=_([]),y=_([]),f=_(0),l=_([]),b=_(2),r=[2,5,10,20,50,100],v=_(0),a=_("00:00");let m=null;const A=S(()=>l.value.length*b.value),V=S(()=>{if(y.value.length===0||l.value.length===0)return 0;const o=y.value[f.value];return(b.value*o.odds).toFixed(2)}),j=S(()=>l.value.length>0&&b.value>=2),H=o=>{const s=C.value.type_code;return s.includes("k3")?["大","小","单","双","和值大","和值小"]:s.includes("ssc")?["0","1","2","3","4","5","6","7","8","9"]:s.includes("11x5")?Array.from({length:11},(B,D)=>String(D+1).padStart(2,"0")):s.includes("pk10")?Array.from({length:10},(B,D)=>String(D+1).padStart(2,"0")):[]},M=o=>{const s=l.value.indexOf(o);s>-1?l.value.splice(s,1):l.value.push(o)},L=()=>{l.value=[]},R=()=>{L()},O=async()=>{if(!w.token){F("请先登录"),I.push("/login");return}if(l.value.length===0){F("请选择投注号码");return}const o=y.value[f.value];st({title:"确认投注",message:`投注 ${l.value.length} 注，共 ${A.value} 元`}).then(async()=>{try{const s=await O({type_code:n.value,play_id:o.id,bet_content:l.value.join(","),bet_amount:A.value});s.code===200&&(F("投注成功"),w.userInfo.balance=s.data.balance,L())}catch(s){console.error("投注失败:",s)}}).catch(()=>{})},W=async()=>{try{const o=await tt(n.value);o.code===200&&(C.value=o.data)}catch(o){console.error("加载彩种信息失败:",o)}},T=async()=>{try{const o=await et(n.value);o.code===200&&(N.value=o.data,v.value=o.data.countdown,E())}catch(o){console.error("加载期号失败:",o)}},q=async()=>{try{const o=await ot(n.value,5);o.code===200&&(x.value=o.data)}catch(o){console.error("加载历史失败:",o)}},z=async()=>{try{const o=await nt(n.value);o.code===200&&(y.value=o.data.filter(s=>s.parent_id===0))}catch(o){console.error("加载玩法失败:",o)}},E=()=>{m&&clearInterval(m),m=setInterval(()=>{v.value>0?(v.value--,a.value=G(v.value)):(a.value="已封盘",clearInterval(m),setTimeout(()=>{T()},3e3))},1e3)},G=o=>{const s=Math.floor(o/60),B=o%60;return`${String(s).padStart(2,"0")}:${String(B).padStart(2,"0")}`};return Y(()=>{W(),T(),q(),z()}),Z(()=>{m&&clearInterval(m)}),{router:I,userStore:w,lotteryInfo:C,currentPeriod:N,historyList:x,playList:y,activePlay:f,selectedNumbers:l,betAmount:b,amountOptions:r,countdown:a,totalAmount:A,expectedWin:V,canSubmit:j,getBetNumbers:H,toggleNumber:M,clearSelected:L,onPlayChange:R,submitBet:O}}},lt={class:"game-page"},rt={class:"game-content"},it={class:"lottery-header"},ct={class:"lottery-info-box"},dt={class:"info-item"},ut={class:"value"},vt={class:"info-item"},_t={class:"value countdown"},mt={class:"history-box"},yt={class:"history-title"},ft={class:"history-list"},bt={class:"period"},pt={class:"numbers"},gt={class:"play-section"},ht={class:"play-content"},kt={class:"bet-area"},wt={class:"bet-grid"},Ct=["onClick"],xt={class:"bet-num"},St={class:"bet-odds"},Pt={class:"bet-info"},It={class:"info-row"},Nt={class:"info-row"},At={class:"total"},Lt={class:"win"},Bt={class:"amount-select"},Dt={class:"amount-btns"},Ft=["onClick"],Ot={class:"bottom-bar"},Tt={class:"balance-info"},Ut={class:"action-btns"};function Vt(I,t,w,n,C,N){const x=p("van-nav-bar"),y=p("van-icon"),f=p("van-button"),l=p("van-tab"),b=p("van-tabs");return d(),u("div",lt,[g(x,{title:n.lotteryInfo.type_name,"left-arrow":"",onClickLeft:t[0]||(t[0]=r=>n.router.back()),fixed:""},null,8,["title"]),e("div",rt,[e("div",it,[e("div",ct,[e("div",dt,[t[2]||(t[2]=e("span",{class:"label"},"当前期号",-1)),e("span",ut,c(n.currentPeriod.period),1)]),e("div",vt,[t[3]||(t[3]=e("span",{class:"label"},"封盘倒计时",-1)),e("span",_t,c(n.countdown),1)])]),e("div",mt,[e("div",yt,[g(y,{name:"clock-o"}),t[4]||(t[4]=i(" 历史开奖 ",-1))]),e("div",ft,[(d(!0),u(h,null,k(n.historyList,r=>(d(),u("div",{key:r.period,class:"history-item"},[e("span",bt,c(r.period),1),e("div",pt,[(d(!0),u(h,null,k(r.open_code.split(","),(v,a)=>(d(),u("span",{key:a,class:"num-ball"},c(v),1))),128))])]))),128))])])]),e("div",gt,[g(b,{active:n.activePlay,"onUpdate:active":t[1]||(t[1]=r=>n.activePlay=r),onChange:n.onPlayChange},{default:P(()=>[(d(!0),u(h,null,k(n.playList,r=>(d(),$(l,{key:r.id,title:r.play_name},{default:P(()=>{var v;return[e("div",ht,[e("div",kt,[e("div",wt,[(d(!0),u(h,null,k(n.getBetNumbers(r),a=>(d(),u("div",{key:a,class:U(["bet-item",{active:n.selectedNumbers.includes(a)}]),onClick:m=>n.toggleNumber(a)},[e("div",xt,c(a),1),e("div",St,c(r.odds),1)],10,Ct))),128))])]),e("div",Pt,[e("div",It,[e("span",null,[t[5]||(t[5]=i("已选：",-1)),e("em",null,c(n.selectedNumbers.length),1),t[6]||(t[6]=i(" 注",-1))]),e("span",null,[t[7]||(t[7]=i("单注金额：",-1)),e("em",null,c(n.betAmount),1),t[8]||(t[8]=i(" 元",-1))])]),e("div",Nt,[e("span",null,[t[9]||(t[9]=i("总投注额：",-1)),e("em",At,c(n.totalAmount),1),t[10]||(t[10]=i(" 元",-1))]),e("span",null,[t[11]||(t[11]=i("预计奖金：",-1)),e("em",Lt,c(n.expectedWin),1),t[12]||(t[12]=i(" 元",-1))])])]),e("div",Bt,[t[13]||(t[13]=e("div",{class:"amount-label"},"单注金额",-1)),e("div",Dt,[(d(!0),u(h,null,k(n.amountOptions,a=>(d(),u("button",{key:a,class:U(["amount-btn",{active:n.betAmount===a}]),onClick:m=>n.betAmount=a},c(a),11,Ft))),128))])]),e("div",Ot,[e("div",Tt,[t[14]||(t[14]=i(" 余额：",-1)),e("span",null,c(((v=n.userStore.userInfo)==null?void 0:v.balance)||0),1),t[15]||(t[15]=i(" 元 ",-1))]),e("div",Ut,[g(f,{plain:"",type:"warning",onClick:n.clearSelected},{default:P(()=>[...t[16]||(t[16]=[i(" 清空 ",-1)])]),_:1},8,["onClick"]),g(f,{type:"danger",disabled:!n.canSubmit,onClick:n.submitBet},{default:P(()=>[...t[17]||(t[17]=[i(" 确认投注 ",-1)])]),_:1},8,["disabled","onClick"])])])])]}),_:2},1032,["title"]))),128))]),_:1},8,["active","onChange"])])])])}const Rt=J(at,[["render",Vt],["__scopeId","data-v-ce80fc80"]]);export{Rt as default};
