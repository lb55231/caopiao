import{_ as z,u as P,q as j,r as f,v as q,p as D,o as E,b as l,c as s,d as x,e as n,f as w,w as t,J,s as m,K,D as M,j as _,g as b,l as g,k as R}from"./index-755e54f6.js";const A={class:"withdraw-page"},G={class:"withdraw-content"},H={key:0,style:{color:"#ee0a24","font-size":"12px"}},O={key:1,style:{color:"#07c160","font-size":"12px"}},Q={class:"submit-box"},X={__name:"Withdraw",setup(Y){const B=P(),k=j(),y=f(!1),c=f(!1),u=f([]),r=f(null),V=f(!0),d=q({amount:"100",password:""}),h=D(()=>u.value.map(a=>({text:`${a.bankname}(${a.banknumber})`,value:a.id,bank:a}))),I=async()=>{try{const a=await J();a.code===200&&(u.value=a.data.list,u.value.length>0&&(r.value=u.value.find(e=>e.isdefault==1)||u.value[0]))}catch{m("加载失败")}},S=({selectedOptions:a})=>{r.value=a[0].bank,c.value=!1},T=async()=>{var o;const a=parseFloat(d.amount),e=100;if(parseFloat(((o=k.userInfo)==null?void 0:o.xima)||0)>0){m("打码不足，洗码余额为0时可以提款");return}if(a<e){m(`最低提款金额为${e}元`);return}if(!r.value){m("请选择银行卡");return}if(!d.password){m("请输入资金密码");return}try{y.value=!0;const i=await K({amount:a,bank_id:r.value.id,password:d.password});i.code===200?(M("提款申请已提交"),setTimeout(()=>{B.back()},1500)):m(i.msg||"提交失败")}catch(i){m(i.message||"网络错误，请稍后重试")}finally{y.value=!1}};return E(()=>{I()}),(a,e)=>{const C=l("van-nav-bar"),o=l("van-field"),i=l("router-link"),W=l("van-cell-group"),L=l("van-button"),N=l("van-form"),U=l("van-picker"),F=l("van-popup");return s(),x("div",A,[n(C,{title:"提款","left-arrow":"",onClickLeft:e[0]||(e[0]=v=>a.$router.back()),fixed:""}),w("div",G,[n(N,{onSubmit:T},{default:t(()=>[n(W,null,{default:t(()=>{var v,$;return[u.value.length>0?(s(),_(o,{key:0,label:"银行",readonly:"","is-link":"","model-value":r.value?`${r.value.bankname}(${r.value.banknumber})`:"请选择银行",onClick:e[1]||(e[1]=p=>c.value=!0)},null,8,["model-value"])):(s(),_(o,{key:1,label:"银行",readonly:""},{input:t(()=>[w("span",null,[e[7]||(e[7]=b("请先",-1)),n(i,{to:"/account/add-bank",style:{color:"#ee0a24",padding:"0 5px"}},{default:t(()=>[...e[6]||(e[6]=[b("绑定银行账户",-1)])]),_:1})])]),_:1})),n(o,{modelValue:d.amount,"onUpdate:modelValue":e[2]||(e[2]=p=>d.amount=p),type:"number",label:"提款金额",placeholder:"提款金额"},null,8,["modelValue"]),n(o,{label:"账户可用金额","model-value":((v=g(k).userInfo)==null?void 0:v.balance)||0,readonly:"",disabled:""},null,8,["model-value"]),n(o,{label:"洗码余额","model-value":(($=g(k).userInfo)==null?void 0:$.xima)||0,readonly:"",disabled:""},{extra:t(()=>{var p;return[parseFloat(((p=g(k).userInfo)==null?void 0:p.xima)||0)>0?(s(),x("span",H," 需为0才可提款 ")):(s(),x("span",O,"✓"))]}),_:1},8,["model-value"]),V.value?(s(),_(o,{key:2,modelValue:d.password,"onUpdate:modelValue":e[3]||(e[3]=p=>d.password=p),type:"password",label:"资金密码",placeholder:"请填写资金密码"},null,8,["modelValue"])):(s(),_(o,{key:3,label:"资金密码",readonly:""},{input:t(()=>[w("span",null,[e[9]||(e[9]=b("请先设置",-1)),n(i,{to:"/user/safepass",style:{color:"#ee0a24",padding:"0 5px"}},{default:t(()=>[...e[8]||(e[8]=[b("资金密码",-1)])]),_:1})])]),_:1}))]}),_:1}),w("div",Q,[u.value.length>0&&V.value?(s(),_(L,{key:0,type:"danger",round:"",block:"","native-type":"submit",loading:y.value},{default:t(()=>[...e[10]||(e[10]=[b(" 确认提款 ",-1)])]),_:1},8,["loading"])):R("",!0)])]),_:1})]),n(F,{show:c.value,"onUpdate:show":e[5]||(e[5]=v=>c.value=v),position:"bottom"},{default:t(()=>[n(U,{columns:h.value,onConfirm:S,onCancel:e[4]||(e[4]=v=>c.value=!1)},null,8,["columns"])]),_:1},8,["show"])])}}},ee=z(X,[["__scopeId","data-v-7f932920"]]);export{ee as default};
