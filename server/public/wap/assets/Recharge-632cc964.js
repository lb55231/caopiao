import{_ as U,u as A,r as M,v as E,p as z,G as J,o as O,b as h,c as u,d as p,e as i,f as n,F as P,h as Y,j as H,w as k,k as x,H as X,s as c,I as W,D as q,n as K,t as V,l as ee,g as D}from"./index-755e54f6.js";import{g as ae}from"./image-19d603d6.js";import{s as te}from"./function-call-fb17f912.js";const oe={class:"recharge-page"},ne={class:"recharge-content"},le={class:"payment-methods"},se={class:"methods-grid"},re=["onClick"],ie={class:"card-icon"},ue={class:"card-title"},de={class:"card-tag"},ce={key:0,class:"online-tag"},me={key:1,class:"offline-tag"},pe={key:0,class:"card-check"},ve={key:0,class:"qrcode-box"},ye={class:"qrcode-title"},ge=["src"],_e={class:"qrcode-tip"},fe={class:"submit-box"},be={class:"submit-box"},he={key:2,class:"remark-box"},ke=["innerHTML"],Ie={__name:"Recharge",setup(we){const T=A(),g=M(!1),I=M([]),_=M(""),l=E({amount:"",userpayname:""}),a=z(()=>I.value.find(t=>t.paytype===_.value)),y=z(()=>{var t;return((t=a.value)==null?void 0:t.configs_array)||{}}),F=async()=>{try{const t=await X();t.code===200&&t.data.list.length>0?(I.value=t.data.list,I.value.length>0&&(_.value=I.value[0].paytype)):c("暂无可用的充值方式")}catch{c("加载失败")}};J(_,()=>{l.amount="",l.userpayname=""});const C=t=>{if(!t)return;const e=document.createElement("input");document.body.appendChild(e),e.setAttribute("value",t),e.select(),document.execCommand("copy")&&q("复制成功"),document.body.removeChild(e)},G=t=>{t.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7kuoznpIHnoIHliqDovb3lpLHotKU8L3RleHQ+PC9zdmc+"},N=async()=>{var v,s;const t=parseFloat(((v=a.value)==null?void 0:v.minmoney)||0),e=parseFloat(((s=a.value)==null?void 0:s.maxmoney)||999999),m=parseFloat(l.amount);if(!l.amount||m<t){c(`充值金额最低为${t}元`);return}if(m>e){c(`充值金额最高为${e}元`);return}if(!l.userpayname){c("请输入您的银行卡姓名");return}try{g.value=!0;const o=await W({amount:m,paytype:a.value.paytype,userpayname:l.userpayname});if(o.code===200){let d='<div style="text-align: left; padding: 10px 0;">';d+='<p style="margin-bottom: 12px; color: #07c160; font-weight: 500;">✓ 充值申请已提交</p>',o.data.bankname&&o.data.bankcode&&(d+='<p style="margin: 8px 0; color: #666;"><span style="color: #323233; font-weight: 500;">收款户名：</span>'+o.data.bankname+"</p>",d+='<p style="margin: 8px 0; color: #666;"><span style="color: #323233; font-weight: 500;">收款账号：</span>'+o.data.bankcode+"</p>"),d+='<p style="margin: 8px 0; color: #666;"><span style="color: #323233; font-weight: 500;">充值金额：</span>'+m+"元</p>",d+='<p style="margin: 8px 0; color: #666;"><span style="color: #323233; font-weight: 500;">订单号：</span>'+o.data.trano+"</p>",d+='<p style="margin-top: 12px; font-size: 12px; color: #969799;">请等待管理员审核</p>',d+="</div>",te({title:"充值提示",message:d,confirmButtonText:"我知道了",confirmButtonColor:"#ee0a24",allowHtml:!0}).then(()=>{T.push("/user")})}else c(o.msg||"提交失败")}catch(o){c(o.message||"网络错误，请稍后重试")}finally{g.value=!1}},Q=async()=>{var v,s;const t=parseFloat(((v=a.value)==null?void 0:v.minmoney)||0),e=parseFloat(((s=a.value)==null?void 0:s.maxmoney)||999999),m=parseFloat(l.amount);if(!l.amount||m<t){c(`充值金额最低为${t}元`);return}if(m>e){c(`充值金额最高为${e}元`);return}try{g.value=!0;const o=await W({amount:m,paytype:a.value.paytype,userpayname:""});o.code===200?o.data.pay_url?window.location.href=o.data.pay_url:(q("充值订单已创建"),setTimeout(()=>{T.push("/records/account")},1500)):c(o.msg||"提交失败")}catch(o){c(o.message||"网络错误，请稍后重试")}finally{g.value=!1}};return O(()=>{F()}),(t,e)=>{var $;const m=h("van-nav-bar"),v=h("van-icon"),s=h("van-field"),o=h("van-cell-group"),d=h("van-button"),R=h("van-form");return u(),p("div",oe,[i(m,{title:"在线充值","left-arrow":"",onClickLeft:e[0]||(e[0]=r=>t.$router.back()),fixed:""}),n("div",ne,[n("div",le,[e[7]||(e[7]=n("div",{class:"methods-title"},"选择充值方式",-1)),n("div",se,[(u(!0),p(P,null,Y(I.value,r=>(u(),p("div",{key:r.id,class:K(["method-card",{active:_.value===r.paytype}]),onClick:f=>_.value=r.paytype},[n("div",ie,[i(v,{name:"balance-pay",size:"20"})]),n("div",ue,V(r.paytypetitle),1),n("div",de,[r.isonline===1?(u(),p("span",ce,"在线")):(u(),p("span",me,"线下"))]),_.value===r.paytype?(u(),p("div",pe,[i(v,{name:"success",size:"14"})])):x("",!0)],10,re))),128))])]),a.value&&a.value.isonline!==1?(u(),H(R,{key:0,onSubmit:N},{default:k(()=>[i(o,{title:"转账信息"},{default:k(()=>{var r,f,w,S,B,L,Z;return[y.value.isewm==="1"&&y.value.ewmurl?(u(),p("div",ve,[n("div",ye,V((r=a.value)==null?void 0:r.paytypetitle),1),n("img",{src:ee(ae)(y.value.ewmurl),class:"qrcode-image",onError:G},null,40,ge),n("p",_e,"请使用"+V((f=a.value)==null?void 0:f.paytypetitle)+"扫描二维码支付",1)])):(u(),p(P,{key:1},[i(s,{label:"收款银行","model-value":(w=a.value)==null?void 0:w.paytypetitle,readonly:""},null,8,["model-value"]),i(s,{label:"收款户名","model-value":y.value.bankname,readonly:"","right-icon":"copy",onClickRightIcon:e[1]||(e[1]=b=>C(y.value.bankname))},null,8,["model-value"]),i(s,{label:"收款账号","model-value":y.value.bankcode,readonly:"","right-icon":"copy",onClickRightIcon:e[2]||(e[2]=b=>C(y.value.bankcode))},null,8,["model-value"]),(S=a.value)!=null&&S.ftitle?(u(),H(s,{key:0,label:"开户支行","model-value":(B=a.value)==null?void 0:B.ftitle,readonly:"","right-icon":"copy",onClickRightIcon:e[3]||(e[3]=b=>{var j;return C((j=a.value)==null?void 0:j.ftitle)})},null,8,["model-value"])):x("",!0)],64)),i(s,{modelValue:l.amount,"onUpdate:modelValue":e[4]||(e[4]=b=>l.amount=b),type:"number",label:"充值金额",placeholder:`${(L=a.value)==null?void 0:L.minmoney}-${(Z=a.value)==null?void 0:Z.maxmoney}元`,required:""},null,8,["modelValue","placeholder"]),i(s,{modelValue:l.userpayname,"onUpdate:modelValue":e[5]||(e[5]=b=>l.userpayname=b),label:"转账户名",placeholder:"请输入付款人的银行卡姓名",required:""},null,8,["modelValue"])]}),_:1}),n("div",fe,[i(d,{type:"danger",round:"",block:"","native-type":"submit",loading:g.value},{default:k(()=>[...e[8]||(e[8]=[D(" 确定 ",-1)])]),_:1},8,["loading"])]),e[9]||(e[9]=n("div",{class:"tips"},[n("p",null,"1、请转账到以上收款银行账户。"),n("p",null,"2、请正确填写转账银行卡的持卡人姓名和充值金额，以便及时核对。"),n("p",null,"3、转账1笔提交1次，请勿重复提交订单。"),n("p",null,"4、请务必转账后再提交订单,否则无法及时查到您的款项！")],-1))]),_:1})):a.value&&a.value.isonline===1?(u(),H(R,{key:1,onSubmit:Q},{default:k(()=>[i(o,{title:"充值信息"},{default:k(()=>{var r,f;return[i(s,{modelValue:l.amount,"onUpdate:modelValue":e[6]||(e[6]=w=>l.amount=w),type:"number",label:"充值金额",placeholder:`${(r=a.value)==null?void 0:r.minmoney}-${(f=a.value)==null?void 0:f.maxmoney}元`,required:""},null,8,["modelValue","placeholder"])]}),_:1}),n("div",be,[i(d,{type:"danger",round:"",block:"","native-type":"submit",loading:g.value},{default:k(()=>[...e[10]||(e[10]=[D(" 立即支付 ",-1)])]),_:1},8,["loading"])])]),_:1})):x("",!0),($=a.value)!=null&&$.remark?(u(),p("div",he,[e[11]||(e[11]=n("div",{class:"remark-title"},"备注说明",-1)),n("div",{class:"remark-content",innerHTML:a.value.remark},null,8,ke)])):x("",!0)])])}}},He=U(Ie,[["__scopeId","data-v-96bbaafa"]]);export{He as default};
