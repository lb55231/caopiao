import{i as Y,_ as ue,A as de,u as me,q as ve,r as c,p as y,o as pe,G as _e,a as he,b as Q,c as m,d as _,f as t,e as A,g as T,t as n,w as ge,F as I,h as E,l as D,k as W,y as fe,z as be,s as k,n as X,j as ye}from"./index-755e54f6.js";import{g as ke}from"./lottery-115786bf.js";import{g as xe}from"./image-19d603d6.js";import{s as we}from"./function-call-fb17f912.js";function Te(C){return Y({url:"/game/period",method:"get",params:{cpname:C}})}function Ce(C){return Y({url:"/game/bet",method:"post",data:C})}const je={class:"k3-game-page"},Fe={class:"game-header"},Be={class:"game-selector"},Ae={class:"game-selector-header"},Ie={class:"game-list"},Ee=["onClick"],$e=["src","alt"],ze={class:"game-info"},Me={class:"game-title"},Re={class:"game-desc"},qe={class:"betting-issue-countdown cz-opennumb"},De={class:"dl-container dl-flex"},Ne={class:"result-header"},Se={class:"dl-flex result-content"},Ve={class:"result-text"},Ge={class:"result-text"},Pe={class:"dl-container dl-flex countdown-row"},Le={class:"countdown-header"},Ue={class:"countdown-content"},Ke={class:"j-lottery-time"},Oe={class:"time-unit hh"},He={class:"bj"},Je={class:"bj"},Qe={class:"time-unit mm"},We={class:"bj"},Xe={class:"bj"},Ye={class:"time-unit ss"},Ze={class:"bj"},et={class:"bj"},tt={class:"ui-container"},st={class:"betting-box"},at={class:"menu dl-container"},ot=["playid","onClick"],lt={class:"shop-item"},nt={class:"shop-item-container dl-container"},ct={class:"ball-list-ul"},it={class:"ball-number1"},rt=["src","alt"],ut={key:0,class:"balance-container"},dt={class:"balance-text"},mt={class:"balance-amount"},vt={class:"amount-input-container"},pt={class:"quick-amount-container"},_t=["onClick"],ht={class:"clear-btn"},gt={class:"clear-btn-right"},ft={class:"total"},bt={class:"betting-sum"},yt={class:"price betting-sum-money"},kt={__name:"K3",setup(C){const j=de(),N=me(),h=ve(),d=c({name:j.params.name||"hebk3",title:j.query.title||"河北快3"}),g=c(!1),S=c([]),Z=()=>{g.value=!0},ee=s=>{if(s.name===d.value.name){g.value=!1;return}g.value=!1,M(),N.push({path:`/game/${s.typeid}/${s.name}`,query:{title:s.title}})},te=async()=>{try{const s=await ke();s.code===200&&s.data&&(S.value=s.data.filter(e=>e.issys==1&&e.isopen==1))}catch(s){console.error("加载游戏列表失败:",s)}},v=c(null),x=c("---"),V=c("---"),G=c("---"),P=c("---"),$=c(0),f=c("00:00:00"),w=c(2);let u=null,i=null;const L=y(()=>{const s=f.value.match(/(\d{2}):(\d{2}):(\d{2})/);return s?s[1]:"00"}),U=y(()=>{const s=f.value.match(/(\d{2}):(\d{2}):(\d{2})/);return s?s[2]:"00"}),K=y(()=>{const s=f.value.match(/(\d{2}):(\d{2}):(\d{2})/);return s?s[3]:"00"}),se=[2,4,10,20,50,100],O=y(()=>{if(!v.value||!v.value.lastResult||!v.value.lastResult.opencode)return{text1:"---",text2:"---"};const s=v.value.lastResult.expect||"",e=v.value.lastFullExpect||"";if(s!==e)return console.warn("期号不匹配！数据库:",s,"计算:",e),{text1:"等待开奖",text2:""};const o=v.value.lastResult.opencode,a=o.split(",").map(Number).reduce((R,q)=>R+q,0),r=a>10?"普货":"精品",B=a%2===0?"一件":"多件";return console.log("开奖结果:",{opencode:o,sum:a,text1:r,text2:B,expect:s}),{text1:r,text2:B}}),H=[{playid:"k3hzbig",value:"大",label:"普货"},{playid:"k3hzsmall",value:"小",label:"精品"},{playid:"k3hzodd",value:"单",label:"一件"},{playid:"k3hzeven",value:"双",label:"多件"}],ae=[{code:"3",name:"李宁",logo:"/resources/k4/5.jpg"},{code:"4",name:"361°",logo:"/resources/k4/6.jpg"},{code:"5",name:"鸿星尔克",logo:"/resources/k4/7.jpg"},{code:"6",name:"顺丰",logo:"/resources/k4/8.jpg"},{code:"7",name:"百雀羚",logo:"/resources/k4/9.jpg"},{code:"8",name:"自然堂",logo:"/resources/k4/10.jpg"},{code:"9",name:"华为",logo:"/resources/k4/11.jpg"},{code:"10",name:"中兴",logo:"/resources/k4/12.jpg"},{code:"11",name:"VIVO",logo:"/resources/k4/13.jpg"},{code:"12",name:"苏宁",logo:"/resources/k4/14.jpg"},{code:"13",name:"美的",logo:"/resources/k4/15.jpg"},{code:"14",name:"格力",logo:"/resources/k4/16.jpg"}],p=c([]),oe=s=>p.value.some(e=>e.value===s),le=s=>{const e=H.find(l=>l.value===s);if(!e)return;const o=p.value.findIndex(l=>l.value===s);o>-1?p.value.splice(o,1):p.value.push({value:e.value,playid:e.playid,label:e.label})},ne=s=>{w.value=s},F=y(()=>p.value.length),z=y(()=>{const s=Number(w.value)||2;return(F.value*s).toFixed(2)}),M=()=>{p.value=[]},ce=async()=>{if(F.value===0){k("请选择商品");return}if(!h.token){k("请先登录"),N.push("/login");return}if(!x.value||x.value==="---"){k("期号信息加载中，请稍后");return}if($.value<=0){k("当前期已截止，请等待下一期");return}we({title:"确认下单",message:`确认下单 ${F.value} 件商品，共 ￥${z.value} 元？`,showCancelButton:!0}).then(async()=>{try{const s=Number(w.value)||2,e=p.value.map(l=>({playId:l.playid,playName:l.label,numbersText:l.value,count:1,multiple:1,price:s,rate:2})),o=await Ce({cpname:d.value.name,cptitle:d.value.title,period:x.value,bets:e});if(k("订单提交成功"),o.data&&o.data.newBalance!==void 0)h.updateBalance(o.data.newBalance);else{const l=(parseFloat(h.balance)-parseFloat(z.value)).toFixed(2);h.updateBalance(l)}M()}catch(s){k(s.message||"提交失败")}}).catch(()=>{})},J=s=>{if(s<=0)return"00:00:00";const e=Math.floor(s/3600),o=Math.floor(s%3600/60),l=s%60,a=e<10?"0":""+Math.floor(e/10),r=e<10?""+e:""+e%10,B=o<10?"0":""+Math.floor(o/10),R=o<10?""+o:""+o%10,q=l<10?"0":""+Math.floor(l/10),re=l<10?""+l:""+l%10;return a+r+":"+B+R+":"+q+re},ie=s=>{u&&clearInterval(u),i&&clearTimeout(i);const e=new Date,o=s*1e3,l=e.getTime()+o;$.value=s,f.value=J(s),o>0?u=setInterval(()=>{const a=new Date().getTime(),r=Math.floor((l-a)/1e3);r>=0?($.value=r,f.value=J(r)):(clearInterval(u),f.value="00:00:00",i=setTimeout(()=>{b()},3e3))},1e3):i=setTimeout(()=>{b()},1e3)},b=async()=>{var s;try{const e=await Te(d.value.name);e.code===200&&e.data&&(v.value=e.data,e.data.currFullExpect&&(x.value=e.data.currFullExpect,V.value=e.data.currFullExpect),e.data.lastFullExpect&&(G.value=e.data.lastFullExpect,P.value=e.data.lastFullExpect),console.log("期号信息:",{当前期:x.value,上期:G.value,数据库上期:(s=e.data.lastResult)==null?void 0:s.expect,倒计时:e.data.remainTime}),e.data.remainTime&&e.data.remainTime>1?ie(e.data.remainTime):i=setTimeout(()=>{b()},5e3))}catch(e){console.error("加载期号失败:",e),i=setTimeout(()=>{b()},5e3)}};return pe(()=>{b(),te()}),_e(()=>j.params.name,(s,e)=>{s&&s!==e&&(d.value={name:s,title:j.query.title||s},u&&(clearInterval(u),u=null),i&&(clearTimeout(i),i=null),b())}),he(()=>{u&&clearInterval(u),i&&clearTimeout(i)}),(s,e)=>{const o=Q("van-icon"),l=Q("van-popup");return m(),_("div",je,[t("header",Fe,[t("div",{class:"header-left",onClick:e[0]||(e[0]=a=>s.$router.back())},[A(o,{name:"arrow-left"})]),t("h1",{class:"header-title",onClick:Z},[T(n(d.value.title)+" ",1),A(o,{name:"arrow-down",size:"14"})]),e[4]||(e[4]=t("div",{class:"header-right"},null,-1))]),A(l,{show:g.value,"onUpdate:show":e[2]||(e[2]=a=>g.value=a),position:"top",style:{height:"auto",maxHeight:"80vh"},round:""},{default:ge(()=>[t("div",Be,[t("div",Ae,[e[5]||(e[5]=t("h3",null,"选择游戏",-1)),A(o,{name:"cross",onClick:e[1]||(e[1]=a=>g.value=!1)})]),t("div",Ie,[(m(!0),_(I,null,E(S.value,a=>(m(),_("div",{key:a.id,class:X(["game-item",{active:a.name===d.value.name}]),onClick:r=>ee(a)},[t("img",{src:D(xe)(a.logo),alt:a.title,class:"game-logo"},null,8,$e),t("div",ze,[t("div",Me,n(a.title),1),t("div",Re,n(a.ftitle||"官方游戏"),1)]),a.name===d.value.name?(m(),ye(o,{key:0,name:"success",color:"#F31C1D",size:"20"})):W("",!0)],10,Ee))),128))])])]),_:1},8,["show"]),t("div",qe,[t("dl",De,[t("dt",Ne,[t("div",null,n(P.value||"---"),1),e[6]||(e[6]=t("div",{class:"result-title"},"订单匹配结果",-1))]),t("dd",Se,[t("div",Ve,n(O.value.text1),1),t("div",Ge,n(O.value.text2),1)])]),t("dl",Pe,[t("dt",Le,[t("div",null,n(V.value||"---"),1),e[7]||(e[7]=t("div",{class:"countdown-title"},"订单匹配截止",-1))]),t("dd",Ue,[t("i",Ke,[t("span",Oe,[t("span",He,n(L.value.charAt(0)),1),t("span",Je,n(L.value.charAt(1)),1)]),e[8]||(e[8]=t("em",null,":",-1)),t("span",Qe,[t("span",We,n(U.value.charAt(0)),1),t("span",Xe,n(U.value.charAt(1)),1)]),e[9]||(e[9]=t("em",null,":",-1)),t("span",Ye,[t("span",Ze,n(K.value.charAt(0)),1),t("span",et,n(K.value.charAt(1)),1)])])])])]),t("section",tt,[t("div",st,[t("div",at,[(m(),_(I,null,E(H,a=>t("div",{key:a.playid,class:X(["menu-item ball-number",{"menu-active":oe(a.value)}]),playid:a.playid,onClick:r=>le(a.value)},n(a.label),11,ot)),64))]),t("div",lt,[t("div",nt,[t("ul",ct,[(m(),_(I,null,E(ae,a=>t("li",{key:a.code,class:"ball-item"},[t("a",it,[t("img",{src:a.logo,alt:a.name},null,8,rt)])])),64))])])]),D(h).token?(m(),_("div",ut,[t("div",dt,[e[10]||(e[10]=T(" 当前余额：",-1)),t("span",mt,n(D(h).balance||"0.00"),1)])])):W("",!0),t("div",vt,[fe(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=a=>w.value=a),class:"amount-input",placeholder:"2"},null,512),[[be,w.value]]),e[11]||(e[11]=t("span",{class:"amount-unit"},"元",-1))]),t("div",pt,[(m(),_(I,null,E(se,a=>t("div",{key:a,class:"quick-amount-btn",onClick:r=>ne(a)},n(a),9,_t)),64))]),t("div",ht,[t("div",{class:"betting-empty",onClick:M},"清空"),t("div",gt,[t("div",ft,[e[12]||(e[12]=T(" 共 ",-1)),t("span",bt,n(F.value),1),e[13]||(e[13]=T(" 件 合计 ￥",-1)),t("span",yt,n(z.value),1),e[14]||(e[14]=T("元 ",-1))]),t("div",{class:"submit-btn",onClick:ce},"提交订单")])])])])])}}},jt=ue(kt,[["__scopeId","data-v-4bd77424"]]);export{jt as default};
